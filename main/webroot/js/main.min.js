var contentView={lang:[],setLang:function(t,e,n){this.lang={add:t,addComment:e,validComment:n}},startLoad:function(){$(".mainLoading").css("display","block")},endLoad:function(){$(".mainLoading").css("display","none")},bindViewForm:function(t){$(t).on("submit",function(t){t.preventDefault();var e=$(this);e.valid()&&(contentView.startLoad(),$.ajax({url:e.attr("action"),type:"POST",data:e.serialize(),success:function(t){contentView.endLoad(),toastr.info(t.message)}}))})},bindViewReportForm:function(t){$(t).on("submit",function(t){t.preventDefault();var e=$(this);e.valid()&&(contentView.startLoad(),$.ajax({url:e.attr("action"),type:"POST",data:e.serialize(),success:function(t){contentView.endLoad(),toastr.info(t.message),setTimeout(function(){window.location.href=window.location},1e3)}}))})},bindViewFormPermission:function(){$("#user-permissions-form").on("submit",function(t){t.preventDefault();var e=$(this);e.valid()&&(contentView.startLoad(),$.ajax({url:e.attr("action"),type:"POST",data:e.serialize(),success:function(t){contentView.endLoad(),toastr.info(t.message),setTimeout(function(){window.location.href=window.location},1e3)}}))})},bindMarkNotification:function(){$(".goToLink").on("click",function(t){let e=this.dataset.markId;$.ajax({url:"/notices/mark/"+e,type:"GET"})})},bindMarkModalNotification:function(){$(".modal-justification").on("click",function(t){console.log($(this).parent().parent().find(".mark-button"));let e=$(this).parent().parent(),n=e.find(".mark-button");console.log(n.attr("href")),$.ajax({url:n.attr("href"),type:"GET",success:function(t){e.removeClass("new-message")}})})},bindClick:function(){$(".link-comment").off("click").on("click",function(t){t.preventDefault();if($(this).parent().parent().find("div.add-comment").length<1){var e=contentView.generateForm();contentView.appendForm(e,this),contentView.validateForm(e),contentView.linkForm(e)}})},generateForm:function(){return Math.floor(1e5*Math.random()+1)},appendForm:function(t,e){var n='<div class="add-comment"><form id="'+t+'" method="post" accept-charset="utf-8" class="form-comment" role="form" action="'+$(e).attr("href")+'" novalidate="novalidate"><div class="form-group textarea required"><label class="control-label" for="description">'+this.lang.addComment+'</label><textarea name="description" maxlength="255" id="description" class="form-control valid" rows="5" aria-invalid="false"></textarea></div><button id="btn'+t+'" type="submit" class="submit-form btn btn-default"><span class=""></span>'+this.lang.add+"</button></div></form></div>";$(e).parent().after(n)},validateForm:function(t){$("#"+t).validate({rules:{description:{required:!0}},messages:{description:{required:this.lang.validComment}}})},linkForm:function(t){$("#"+t).on("submit",function(e){e.preventDefault();var n=$(this);n.valid()&&($("#btn"+t).attr("disabled",!0).find("span").addClass("loading"),$.ajax({url:n.attr("action"),type:"POST",data:n.serialize(),success:function(e){let i=JSON.parse(e);if(i.success){if(n[0].reset(),$(n).parent().parent().append(i.output),$("#comments-summary").html("("+parseInt(i.comments)+")"),n.fadeOut("slow",function(){$(n).parent().remove()}),contentView.bindClick(),contentView.linkReport(),contentView.linkEditComment(),!n.parent().parent().hasClass("first-notes")){let t=n.parent().siblings(".comment-inner").children(".sub");n.parent().siblings(".comment-inner").children(".subscription").addClass("subInActiveButton"),t.removeClass("subInActiveButton")}}else alert(i.message),$("#btn"+t).attr("disabled",!1).find("span").removeClass("loading")}}))})},linkEditComment:function(){$(".link-edit").off("click").on("click",function(t){let e=$(this);t.preventDefault(),$.ajax({url:e.data("item"),type:"GET",success:function(t){t.success?($("#editComment").val(t.content),$("#comment-edit-link").attr("href",e.attr("href")),$("#editModalComment").modal("show")):window.location.href=window.location}})})},submitEditComment:function(){$("#comment-edit-link").on("click",function(t){if(t.preventDefault(),$("#form-edit-comment").valid()){var e=$(this);$(e).attr("disabled",!0),$(e).find("span").addClass("loading"),$.ajax({url:e.attr("href"),type:"POST",data:{description:$("#editComment").val()},success:function(t){t.success?window.location.href=window.location:($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1))}})}})},linkEditAnswer:function(){$(".link-edit-answer").off("click").on("click",function(t){let e=$(this);t.preventDefault(),$.ajax({url:e.data("item"),type:"GET",success:function(t){t.success?(CKEDITOR.instances.editCommentAnswer.setData(t.content),$("#answer-edit-link").attr("href",e.attr("href")),$("#editModalAnswer").modal("show")):window.location.href=window.location}})})},submitEditAnswer:function(){$("#answer-edit-link").on("click",function(t){if(t.preventDefault(),$("#form-edit-answer").valid()){var e=$(this);$(e).attr("disabled",!0),$(e).find("span").addClass("loading"),$.ajax({url:e.attr("href"),type:"POST",data:{description:$("#editCommentAnswer").val()},success:function(t){t.success?window.location.href=window.location:($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1))}})}})},bindModalForm:function(t,e){$(t).on("submit",function(t){if(t.preventDefault(),$(this).valid()){$(e).attr("disabled",!0),$(e).find("span").addClass("loading");var n=$(this);$.ajax({url:n.attr("action"),type:"POST",data:n.serialize(),success:function(t){JSON.parse(t).success?window.location.href=window.location:($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1))}})}})},bindModalFormCK:function(t,e){$(t).on("submit",function(t){if(t.preventDefault(),$(this).valid()){$(e).attr("disabled",!0),$(e).find("span").addClass("loading");var n=$(this);$.ajax({url:n.attr("action"),type:"POST",data:n.serialize(),success:function(t){JSON.parse(t).success?window.location.href=window.location:($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1))}})}})},moreComments:function(){$("#more-comments").on("click",function(t){t.preventDefault(),$.ajax({url:$(this).attr("href"),type:"GET",success:function(t){let e=JSON.parse(t);e.success&&($("#notes-comments").append(e.output),""!==e.pageUrl?$("#more-comments").attr("href",e.pageUrl):$("#more-comments").remove(),contentView.bindClick(),contentView.linkReport(),contentView.linkRemove(),contentView.bindVoteUp())}})})},linkReport:function(){$(".link-report").off("click").on("click",function(t){t.preventDefault(),$("#reportModal").modal("show"),$("#modal-content").empty().append($(this).parent().parent().find("div.user-comment")[0].innerText),$("#report-link").attr("href",$(this).attr("href"))})},linkReportQuestion:function(){$(".link-report-question").off("click").on("click",function(t){t.preventDefault(),$("#reportModal").modal("show"),$("#modal-content").empty().append($(this).parent().parent().find("div.user-comment")[0].innerText),$("#report-link").attr("href",$(this).attr("href"))})},linkReportContent:function(){$(".link-report-content").off("click").on("click",function(t){t.preventDefault(),$("#reportModal").modal("show"),$("#report-link").attr("href",$(this).attr("href"))})},linkRemove:function(){$(".link-remove").on("click",function(t){t.preventDefault(),$("#removeModal").modal("show"),$("#remove-link").attr("href",$(this).attr("href"))})},removeModal:function(t){$("#form-remove").validate({rules:{content:"required"},messages:{content:t}}),$("#remove-link").on("click",function(t){if(t.preventDefault(),$("#form-remove").valid()){var e=$(this);$(e).attr("disabled",!0),$(e).find("span").addClass("loading"),$.ajax({url:e.attr("href"),type:"POST",data:{content:$("#removeReason").val()},success:function(t){t.success?window.location.href=window.location:($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1))}})}})},reportModal:function(){$("#report-link").on("click",function(t){if(t.preventDefault(),$("#form-report").valid()){var e=$(this);$(e).attr("disabled",!0),$(e).find("span").addClass("loading"),$.ajax({url:$(this).attr("href"),type:"POST",data:{type:$("#addReportType").val(),content_input:$("#addReportInput").val(),content_text:$("#addReportText").val()},success:function(t){t.success?window.location.href=window.location:($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1))}})}})},bindVote:function(){$(".vote").on("click",function(t){t.preventDefault();var e=$(this);$.ajax({url:$(this).attr("href"),type:"GET",success:function(t){if(t.success)if($("#v-agree, #vd-agree").empty().html(t.agree),e.hasClass("voted"))e.removeClass("voted");else{e.addClass("voted");var n=e.parent().siblings(".sub.subInActiveButton"),i=e.parent().siblings(".subscription");n.length&&(i.addClass("subInActiveButton"),n.removeClass("subInActiveButton"))}}})})},bindVoteUp:function(){$(".vote-up-comment").off("click").on("click",function(t){t.preventDefault();var e="#"+$(this).attr("id")+"-comment",n=$(this);$.ajax({url:$(this).attr("href"),type:"GET",success:function(t){if(t.success)if($(e).empty().html(t.votes),n.hasClass("voted"))n.removeClass("voted");else{n.addClass("voted");var i=n.parent().siblings(".sub.subInActiveButton"),a=n.parent().siblings(".subscription");i.length&&(a.addClass("subInActiveButton"),i.removeClass("subInActiveButton"))}}})})},bindSubscription:function(){$(".subscription").on("click",function(t){t.preventDefault();var e=$(this),n=$(".user-fallowers").find(".count");$.ajax({url:$(this).attr("href"),type:"GET",success:function(t){if(t.success){if(e.siblings(".subscription").removeClass("subInActiveButton"),e.addClass("subInActiveButton"),$("a[title='add subscription']").hasClass("subInActiveButton")){if(n){let t=n.text();n.text(parseInt(t)+1)}}else if(n){let t=n.text();n.text(parseInt(t)-1)}}else alert(t.message)},error:function(t){alert("An unexpected error has occurred")}})})},bindSubscriptionNote:function(){$(".subscription-note").on("click",function(t){t.preventDefault();var e=$(this);$.ajax({url:$(this).attr("href"),type:"GET",success:function(t){t.success?(e.siblings(".subscription").removeClass("subInActiveButton"),e.addClass("subInActiveButton")):alert(t.message)},error:function(t){alert("An unexpected error has occurred")}})})},bindSubscriptionAndDeleteParent:function(){$(".subscription").on("click",function(t){t.preventDefault();var e=$(this);let n=e.parent().parent(),i=e.parent().parent().parent();$.ajax({url:$(this).attr("href"),type:"GET",success:function(t){t.success?(2===i.children().length&&i.addClass("removeAll"),n.remove()):alert(t.message)},error:function(t){alert("An unexpected error has occurred")}})})},bindFormComment:function(){$(".form-comment").on("submit",function(t){t.preventDefault();var e=$(this);$.ajax({url:e.attr("action"),type:"POST",data:e.serialize(),success:function(t){window.location.reload()}})})},bindCommentLink:function(){$("#comment-link").on("click",function(t){if(t.preventDefault(),$("#form-sub-comment").valid()){var e=$(this);$(e).attr("disabled",!0),$(e).find("span").addClass("loading"),$.ajax({url:$(this).attr("href"),type:"POST",data:{description:$("#addComment").val()},success:function(t){JSON.parse(t).success?window.location.href=window.location:($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1))}})}})},bindLinkCommentQuestion:function(){$(".link-comment").off("click").on("click",function(t){t.preventDefault(),$("#commentModal").modal("show"),$("#modal-content-comment").empty().append($(this).parent().find("div.user-comment")[0].innerText),$("#comment-link").attr("href",$(this).attr("href"))}),$(".link-comment-question").off("click").on("click",function(t){t.preventDefault(),$("#commentModal").modal("show"),$("#modal-content-comment").empty().append($(this).parent().parent().find("div.user-comment")[0].innerHTML),$("#comment-link").attr("href",$(this).attr("href"))})},bindImagePreview:function(){var t=new FileReader;t.onload=function(t){$("#image-content").css("background-image","url("+t.target.result+")")},$("#photo").change(function(){!function(e){e.files&&e.files[0]&&t.readAsDataURL(e.files[0])}(this)})},bindSelect:function(t){$(".js-example-basic-single").select2({tags:!0,maximumSelectionLength:3,selectOnClose:!0,language:{maximumSelected:function(){return t}}})},bindReportModal:function(){$("#form-report").validate({}),$("#addReportType").on("change",function(){3===parseInt($(this).val())?($("#addReportText").rules("add",{required:!0,minlength:3,messages:{required:"<?= __('Reason cannot be empty.') ?>",minlength:"<?= __('Reason must have min. 20 characters.') ?>"}}),$("#reportTextContainer").show(),$("#addReportInput").rules("remove"),$("#reportInputContainer").hide()):2===parseInt($(this).val())?($("#addReportInput").rules("add",{required:!0,messages:{required:"<?= __('Field cannot be empty.') ?>"}}),$("#reportInputContainer").show(),$("#addReportText").rules("remove"),$("#reportTextContainer").hide()):($("#reportInputContainer").hide(),$("#reportTextContainer").hide())}).trigger("change")},bindReportRemove:function(t,e){$("#form-report-delete").validate({rules:{description:"required"},messages:{description:t}}),$("#form-report-delete").on("submit",function(t){t.preventDefault();var n=$("#submit-delete");if($(this).valid()){$(n).attr("disabled",!0),$(n).find("span").addClass("loading");var i=$(this);$.ajax({url:i.attr("action"),type:"POST",data:i.serialize(),success:function(t){t.success?window.location.href=e:($(n).find("span").removeClass("loading"),$(n).attr("disabled",!1))}})}})},bindReportReject:function(t){$("#form-report-reject").validate({rules:{description:"required"},messages:{description:t}}),$("#form-report-reject").on("submit",function(t){t.preventDefault();var e=$("#submit-reject");if($(this).valid()){$(e).attr("disabled",!0),$(e).find("span").addClass("loading");var n=$(this);$.ajax({url:n.attr("action"),type:"POST",data:n.serialize(),success:function(t){t.success?($(e).find("span").removeClass("loading"),toastr.info(t.message),$(".btn-report-action").attr("disabled",!0),setTimeout(function(){window.location.href="/reports/waiting"},1e3)):($(e).find("span").removeClass("loading"),$(e).attr("disabled",!1),$(e).text("Error"))}})}})},bindReportContact:function(t){$("#form-report-contact").validate({rules:{description:"required"},messages:{description:t}}),$("#form-report-contact").on("submit",function(t){t.preventDefault();var e=$("#submit-contact");if($(this).valid()){$(e).attr("disabled",!0),$(e).find("span").addClass("loading");var n=$(this);$.ajax({url:n.attr("action"),type:"POST",data:n.serialize(),success:function(t){t.success?($(e).find("span").removeClass("loading"),toastr.info(t.message),$("#buttonReportContact").attr("disabled",!0),setTimeout(function(){window.location.href="/reports/waiting"},1e3)):($(e).find("span").removeClass("loading"),toastr.error(t.message),$(e).attr("disabled",!1))}})}})},bindReportAccept:function(){$("#reason-accept").on("click",function(t){t.preventDefault();var e=$(this);e.attr("disabled",!0),e.find("span").addClass("loading"),$.ajax({url:e.data("href"),type:"GET",success:function(t){t.success?($(e).find("span").removeClass("loading"),toastr.info(t.message),$(".btn-report-action").attr("disabled",!0)):(e.find("span").removeClass("loading"),e.attr("disabled",!1))}})})}};